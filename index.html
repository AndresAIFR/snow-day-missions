<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#FFF8F0">
    <title>Snow Day Missions</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>%E2%9D%84%EF%B8%8F</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{
            --bg:#FFF8F0;--card:#FFFFFF;--border:#2D2D2D;
            --text:#2D2D2D;--text-mid:#555;--text-light:#888;
            --reading:#3B82F6;--reading-bg:#DBEAFE;
            --math-jr:#22C55E;--math-jr-bg:#DCFCE7;
            --math-sr:#FF9500;--math-sr-bg:#FFF0DD;
        }
        html{font-size:16px}
        body{
            font-family:'DM Sans',system-ui,sans-serif;
            background:var(--bg);color:var(--text);
            min-height:100vh;min-height:100dvh;display:flex;flex-direction:column;
            align-items:center;padding:30px 16px 60px;
            overflow-x:hidden;-webkit-font-smoothing:antialiased;
            position:relative;
        }
        .wrap{width:100%;max-width:520px;position:relative;z-index:1}

        /* ─── DESKTOP ─── */
        @media(min-width:768px){
            .wrap{max-width:640px}
            .header h1{font-size:2.6rem}
            .header p{font-size:1.15rem}
            .mission{padding:28px 26px;gap:22px}
            .mission-icon{width:80px;height:80px;font-size:2.4rem;border-radius:22px}
            .mission-info h2{font-size:1.35rem}
            .mission-info p{font-size:1rem}
            .badge{font-size:.75rem;padding:4px 14px}
            .missions{gap:18px}
        }
        @media(min-width:1024px){
            .wrap{max-width:720px}
            body{padding:50px 20px 80px}
            .header{margin-bottom:44px}
            .header-icon{font-size:4rem}
            .header h1{font-size:3rem}
            .header p{font-size:1.25rem}
            .mission{padding:32px 30px;border-radius:24px}
            .mission-icon{width:90px;height:90px;font-size:2.8rem}
            .mission-info h2{font-size:1.5rem}
            .mission-info p{font-size:1.1rem}
        }

        /* ─── REDUCED MOTION ─── */
        @media(prefers-reduced-motion:reduce){
            *,*::before,*::after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important}
            .snow,.flake{display:none!important}
        }

        /* ─── SNOWFLAKES ─── */
        .snow{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;overflow:hidden;z-index:0}
        .flake{
            position:absolute;top:-20px;color:#B8D4E8;opacity:.6;
            animation:fall linear infinite;
            font-size:var(--size,16px);
        }
        @keyframes fall{
            0%{transform:translateY(-20px) rotate(0deg)}
            100%{transform:translateY(calc(100vh + 40px)) rotate(var(--spin,360deg))}
        }

        /* ─── HEADER ─── */
        .header{text-align:center;margin-bottom:32px}
        .header-icon{font-size:3.2rem;margin-bottom:8px;display:block;animation:bounce .7s cubic-bezier(.34,1.56,.64,1)}
        .header h1{
            font-family:'Fredoka',sans-serif;font-weight:700;
            font-size:2.1rem;letter-spacing:-1px;margin-bottom:6px;
        }
        .header p{color:var(--text-mid);font-size:1.05rem;line-height:1.6}

        /* ─── MISSION CARDS ─── */
        .missions{display:flex;flex-direction:column;gap:14px}
        .mission{
            display:flex;align-items:center;gap:18px;
            background:var(--card);border:3px solid var(--border);
            border-radius:20px;padding:22px 20px;
            box-shadow:4px 4px 0 var(--border);
            text-decoration:none;color:var(--text);
            transition:transform .12s,box-shadow .12s;
            cursor:pointer;-webkit-tap-highlight-color:transparent;
        }
        .mission:hover{transform:translateY(-3px);box-shadow:4px 7px 0 var(--border)}
        .mission:active{transform:translateY(2px);box-shadow:2px 2px 0 var(--border)}

        .mission-icon{
            width:68px;height:68px;border-radius:18px;
            border:3px solid var(--border);
            display:flex;align-items:center;justify-content:center;
            font-size:2rem;flex-shrink:0;
            box-shadow:2px 2px 0 var(--border);
        }
        .mission-info{flex:1;min-width:0}
        .mission-info h2{
            font-family:'Fredoka',sans-serif;font-weight:700;
            font-size:1.15rem;letter-spacing:-.3px;margin-bottom:2px;
        }
        .mission-info p{font-size:.88rem;color:var(--text-mid);line-height:1.4;margin-bottom:6px}
        .badge{
            display:inline-block;padding:3px 10px;border-radius:20px;
            font-family:'Fredoka',sans-serif;font-weight:600;font-size:.65rem;
            text-transform:uppercase;letter-spacing:.5px;
            border:2px solid var(--border);
        }
        .arrow{
            font-size:1.3rem;color:var(--text-light);flex-shrink:0;
            transition:transform .2s;
        }
        .mission:hover .arrow{transform:translateX(4px)}

        /* ─── CARD THEMES ─── */
        .mission.reading .mission-icon{background:var(--reading-bg);color:var(--reading)}
        .mission.reading .badge{background:var(--reading-bg);color:var(--reading)}

        .mission.math-jr .mission-icon{background:var(--math-jr-bg);color:var(--math-jr)}
        .mission.math-jr .badge{background:var(--math-jr-bg);color:var(--math-jr)}

        .mission.math-sr .mission-icon{background:var(--math-sr-bg);color:var(--math-sr)}
        .mission.math-sr .badge{background:var(--math-sr-bg);color:var(--math-sr)}

        /* ─── FOOTER ─── */
        .footer{text-align:center;margin-top:32px;font-size:.78rem;color:var(--text-light)}

        /* ─── ANIMATIONS ─── */
        @keyframes bounce{0%{transform:scale(0)}65%{transform:scale(1.15)}100%{transform:scale(1)}}
        @keyframes fadeUp{from{transform:translateY(18px);opacity:0}to{transform:translateY(0);opacity:1}}
        .missions .mission{animation:fadeUp .5s ease both}
        .missions .mission:nth-child(1){animation-delay:.1s}
        .missions .mission:nth-child(2){animation-delay:.2s}
        .missions .mission:nth-child(3){animation-delay:.3s}

        @media(max-width:380px){
            .header h1{font-size:1.7rem}
            .mission{padding:16px 14px;gap:14px}
            .mission-icon{width:56px;height:56px;font-size:1.6rem}
            .mission-info h2{font-size:1rem}
        }
        /* ─── NAME GATE ─── */
        .name-gate{
            text-align:center;padding-top:20px;
            animation:fadeUp .5s ease both;
        }
        .name-gate h2{
            font-family:'Fredoka',sans-serif;font-weight:700;
            font-size:1.5rem;letter-spacing:-.5px;margin-bottom:6px;
        }
        .name-gate p{color:var(--text-mid);font-size:.95rem;margin-bottom:24px}
        .name-input{
            width:100%;padding:16px 20px;
            font-family:'Fredoka',sans-serif;font-weight:600;font-size:1.15rem;
            background:var(--card);color:var(--text);
            border:3px solid var(--border);border-radius:16px;
            box-shadow:4px 4px 0 var(--border);
            outline:none;text-align:center;
            -webkit-tap-highlight-color:transparent;
        }
        .name-input:focus{border-color:#3B82F6;box-shadow:4px 4px 0 #3B82F6}
        .name-input::placeholder{color:var(--text-light);font-weight:400}
        .name-submit{
            display:inline-block;margin-top:16px;padding:14px 40px;
            background:#3B82F6;color:#fff;
            border:3px solid var(--border);border-bottom-width:7px;border-radius:16px;
            font-family:'Fredoka',sans-serif;font-weight:700;font-size:1.1rem;
            cursor:pointer;transition:all .1s;
            -webkit-tap-highlight-color:transparent;min-height:48px;
        }
        .name-submit:hover{transform:translateY(-2px)}
        .name-submit:active{transform:translateY(4px);border-bottom-width:3px}
        .name-submit:disabled{opacity:.5;cursor:default;transform:none}
        .welcome-bar{
            display:flex;align-items:center;justify-content:center;gap:8px;
            margin-bottom:8px;
            font-family:'Fredoka',sans-serif;font-weight:600;font-size:1rem;
            animation:fadeUp .3s ease both;
        }
        .welcome-bar .change-link{
            font-size:.8rem;color:var(--text-light);cursor:pointer;
            text-decoration:underline;font-weight:400;
        }
        .welcome-bar .change-link:hover{color:var(--text)}
        .hidden{display:none!important}
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<div class="snow" id="snow"></div>

<div class="wrap">
    <div class="header">
        <span class="header-icon">&#x2744;&#xFE0F;</span>
        <h1>Snow Day Missions</h1>
        <p>School's closed, but the fun isn't!<br>Pick your mission and earn points.</p>
    </div>

    <!-- NAME GATE -->
    <div class="name-gate" id="name-gate">
        <h2>What's your name?</h2>
        <p>So your teacher can see your awesome work!</p>
        <input type="text" class="name-input" id="name-input" placeholder="Type your first name..." maxlength="40" autocomplete="off" autofocus>
        <br>
        <button class="name-submit" id="name-submit" disabled>Let's Go!</button>
    </div>

    <!-- WELCOME BAR (shown when name is already set) -->
    <div class="welcome-bar hidden" id="welcome-bar">
        <span id="welcome-text"></span>
        <span class="change-link" id="change-name">change</span>
    </div>

    <div class="missions hidden" id="missions-list">
        <a href="reading.html" class="mission reading">
            <div class="mission-icon">&#x1F4D6;</div>
            <div class="mission-info">
                <h2>Decoder Mission</h2>
                <p>Crack the code with vowels, syllables, and a secret story!</p>
                <span class="badge">Reading</span>
            </div>
            <span class="arrow">&#x276F;</span>
        </a>

        <a href="math-junior.html" class="mission math-jr">
            <div class="mission-icon">&#x1F50D;</div>
            <div class="mission-info">
                <h2>Number Detectives</h2>
                <p>Solve cases with patterns, place value, and money!</p>
                <span class="badge">Math 3-4</span>
            </div>
            <span class="arrow">&#x276F;</span>
        </a>

        <a href="math-senior.html" class="mission math-sr">
            <div class="mission-icon">&#x1F680;</div>
            <div class="mission-info">
                <h2>Number Ops Challenge</h2>
                <p>Add, subtract, and solve word problems!</p>
                <span class="badge">Math 5-6</span>
            </div>
            <span class="arrow">&#x276F;</span>
        </a>
    </div>

    <div class="footer hidden" id="footer">Snow Day Missions &mdash; do your best work!</div>
</div>

<script>
/* ─── SUPABASE INIT ─── */
var SUPABASE_URL = 'https://gpvvxfgpxzhhrvypblvz.supabase.co';
var SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdwdnZ4ZmdweHpoaHJ2eXBibHZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIyMjM2NjMsImV4cCI6MjA4Nzc5OTY2M30.bGHqMi-QdKXkSnsB2b3kpoG72xVd_xYxRAWENnORP7A';
var _sb = window.supabase ? window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON) : null;

/* ─── DOM REFS ─── */
var nameGate = document.getElementById('name-gate');
var nameInput = document.getElementById('name-input');
var nameSubmit = document.getElementById('name-submit');
var welcomeBar = document.getElementById('welcome-bar');
var welcomeText = document.getElementById('welcome-text');
var changeName = document.getElementById('change-name');
var missionsList = document.getElementById('missions-list');
var footer = document.getElementById('footer');

/* ─── NAME LOGIC ─── */
function showMissions() {
    nameGate.classList.add('hidden');
    welcomeBar.classList.remove('hidden');
    missionsList.classList.remove('hidden');
    footer.classList.remove('hidden');
}

function showNameGate() {
    nameGate.classList.remove('hidden');
    welcomeBar.classList.add('hidden');
    missionsList.classList.add('hidden');
    footer.classList.add('hidden');
    nameInput.value = '';
    nameInput.focus();
}

/* Enable/disable submit based on input */
nameInput.addEventListener('input', function() {
    nameSubmit.disabled = nameInput.value.trim().length === 0;
});

/* Submit on Enter */
nameInput.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && nameInput.value.trim().length > 0) {
        submitName();
    }
});

nameSubmit.addEventListener('click', submitName);

function submitName() {
    var name = nameInput.value.trim();
    if (!name) return;
    nameSubmit.disabled = true;
    nameSubmit.textContent = 'Loading...';

    /* Store name locally */
    localStorage.setItem('sdm-student-name', name);

    /* Upsert to Supabase */
    if (_sb) {
        _sb.from('sdm_students')
            .upsert({ name: name }, { onConflict: 'name' })
            .select('id')
            .single()
            .then(function(res) {
                if (res.data && res.data.id) {
                    localStorage.setItem('sdm-student-id', res.data.id);
                }
                welcomeText.textContent = 'Hi, ' + name + '!';
                nameSubmit.textContent = "Let's Go!";
                showMissions();
            })
            .catch(function() {
                /* Fallback: show missions even if Supabase fails */
                welcomeText.textContent = 'Hi, ' + name + '!';
                nameSubmit.textContent = "Let's Go!";
                showMissions();
            });
    } else {
        welcomeText.textContent = 'Hi, ' + name + '!';
        nameSubmit.textContent = "Let's Go!";
        showMissions();
    }
}

/* Change name link */
changeName.addEventListener('click', function() {
    localStorage.removeItem('sdm-student-name');
    localStorage.removeItem('sdm-student-id');
    showNameGate();
});

/* ─── INIT: Check if name already set ─── */
(function() {
    var savedName = localStorage.getItem('sdm-student-name');
    if (savedName) {
        welcomeText.textContent = 'Hi, ' + savedName + '!';
        showMissions();
        /* Re-fetch student ID if missing */
        if (!localStorage.getItem('sdm-student-id') && _sb) {
            _sb.from('sdm_students')
                .upsert({ name: savedName }, { onConflict: 'name' })
                .select('id')
                .single()
                .then(function(res) {
                    if (res.data && res.data.id) {
                        localStorage.setItem('sdm-student-id', res.data.id);
                    }
                });
        }
    } else {
        showNameGate();
    }
})();

/* ─── SNOWFLAKES ─── */
(function(){
    const container = document.getElementById('snow');
    const flakes = ['&#x2744;','&#x2745;','&#x2746;','&#x2022;'];
    for(let i = 0; i < 30; i++){
        const el = document.createElement('div');
        el.className = 'flake';
        el.innerHTML = flakes[Math.random()*flakes.length|0];
        const size = 10 + Math.random()*18;
        const dur = 6 + Math.random()*10;
        const delay = Math.random()*8;
        const left = Math.random()*100;
        const spin = 180 + Math.random()*540;
        el.style.cssText = `
            left:${left}%;
            --size:${size}px;
            font-size:${size}px;
            animation-duration:${dur}s;
            animation-delay:${delay}s;
            --spin:${spin}deg;
            opacity:${.2+Math.random()*.4};
        `;
        container.appendChild(el);
    }
})();
</script>
</body>
</html>
